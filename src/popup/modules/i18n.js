// Internationalization (i18n) Module
// Handles translations and language management

export const TRANSLATIONS = {
    vi: {
        title: 'TubeTuner',
        subtitle: 'áº¨n cÃ¡c pháº§n tá»­ YouTube khÃ´ng mong muá»‘n',
        // Content & Feed Controls
        contentFeedControlsTitle: 'Quáº£n lÃ½ Ná»™i dung & Báº£ng tin',
        hideHomeFeed: 'áº¨n trang chá»§',
        hideVideoSidebar: 'áº¨n thanh bÃªn video',
        hideShorts: 'áº¨n Shorts',
        hideComments: 'áº¨n pháº§n bÃ¬nh luáº­n',
        hideChannel: 'áº¨n kÃªnh',
        // Interface Elements
        interfaceElementsTitle: 'ThÃ nh Pháº§n Giao Diá»‡n',
        hideTopHeader: 'áº¨n thanh Ä‘iá»u hÆ°á»›ng trÃªn',
        hideNotificationsBell: 'áº¨n chuÃ´ng thÃ´ng bÃ¡o',
        hideExploreSection: 'áº¨n pháº§n KhÃ¡m phÃ¡',
        hideMoreFromYouTube: 'áº¨n "ThÃªm tá»« YouTube"',
        hideButtonsBar: 'áº¨n thanh nÃºt báº¥m',
        // Video Controls
        videoControlsTitle: 'TrÃ¬nh phÃ¡t Video',
        hideProgressBar: 'áº¨n thanh tiáº¿n trÃ¬nh',
        hideDuration: 'áº¨n thá»i lÆ°á»£ng video',
        hideEndScreenCards: 'áº¨n tháº» cuá»‘i video',
        hideDescription: 'áº¨n mÃ´ táº£ video',
        // General
        active: 'Äang hoáº¡t Ä‘á»™ng',
        inactive: 'ÄÃ£ táº¯t',
        infoTitle: 'Giá»›i thiá»‡u',
        infoContent: 'Extension giÃºp báº¡n táº­p trung vÃ o ná»™i dung video mÃ  khÃ´ng bá»‹ phÃ¢n tÃ¢m bá»Ÿi:',
        featureProgress: 'CÃ¡c pháº§n tá»­ giao diá»‡n khÃ´ng cáº§n thiáº¿t',
        featureDuration: 'Ná»™i dung Ä‘á» xuáº¥t vÃ  quáº£ng cÃ¡o',
        featureShorts: 'CÃ¡c tÃ­nh nÄƒng gÃ¢y xao nhÃ£ng',
        homeFeed: 'Trang chá»§',
        infoExtra: 'TÃ¹y chá»‰nh tráº£i nghiá»‡m YouTube theo Ã½ muá»‘n cá»§a báº¡n vá»›i 14 tÃ¹y chá»n áº©n/hiá»‡n.',
        noticeTitle: 'LÆ°u Ã½ quan trá»ng',
        noticeDesc: 'Äá»ƒ cÃ³ tráº£i nghiá»‡m tá»‘t nháº¥t, hÃ£y báº­t extension trÆ°á»›c khi vÃ o trang YouTube.',
        // Grayscale feature translations
        grayscale: 'Giao diá»‡n Ä‘en tráº¯ng',
        enableGrayscale: 'Báº­t giao diá»‡n Ä‘en tráº¯ng',
        disableGrayscale: 'Táº¯t giao diá»‡n Ä‘en tráº¯ng',
        // Shop feature translations
        shop: 'YouTube Shop',
        hideShop: 'áº¨n YouTube Shop',
        // Presets UI
        presetsLabel: 'CÃ i Ä‘áº·t sáºµn',
        applyPreset: 'Ãp dá»¥ng preset',
        confirmApplyPreset: 'Báº¡n cÃ³ muá»‘n Ã¡p dá»¥ng preset? Äiá»u nÃ y sáº½ ghi Ä‘Ã¨ cÃ i Ä‘áº·t hiá»‡n táº¡i.',
        presetApplied: 'Ãp dá»¥ng thÃ nh cÃ´ng',
        applyingPreset: 'Äang Ã¡p dá»¥ng preset...',
        confirm: 'XÃ¡c nháº­n',
        cancel: 'Há»§y',
        presetNone: 'KhÃ´ng',
        presetBalanced: 'CÃ¢n báº±ng',
        presetFocus: 'Táº­p trung',
        builtInGroup: 'Máº·c Ä‘á»‹nh',
        customGroup: 'TÃ¹y chá»‰nh',
        presetNamePlaceholder: 'TÃªn preset',
        savePreset: 'LÆ°u preset',
        deletePreset: 'XÃ³a preset',
        importPresets: 'Nháº­p preset',
        exportPresets: 'Xuáº¥t preset',
        presetSaved: 'ÄÃ£ lÆ°u preset',
        presetDeleted: 'ÄÃ£ xÃ³a preset',
        presetsImported: 'ÄÃ£ nháº­p preset',
        presetNameRequired: 'Vui lÃ²ng nháº­p tÃªn cho preset',
        selectPresetToDelete: 'Vui lÃ²ng chá»n má»™t preset tÃ¹y chá»‰nh Ä‘á»ƒ xÃ³a',
        confirmOverwritePreset: 'Preset "%s" Ä‘Ã£ tá»“n táº¡i. Báº¡n cÃ³ muá»‘n ghi Ä‘Ã¨?',
        presetNameReserved: 'TÃªn nÃ y Ä‘Æ°á»£c dÃ nh riÃªng cho há»‡ thá»‘ng',
        confirmDeletePreset: 'Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a preset',
        // Settings management
        settingsManagement: 'Quáº£n lÃ½ cÃ i Ä‘áº·t',
        exportSettings: 'Xuáº¥t cÃ i Ä‘áº·t',
        importSettings: 'Nháº­p cÃ i Ä‘áº·t',
        exportSuccess: 'ÄÃ£ xuáº¥t cÃ i Ä‘áº·t thÃ nh cÃ´ng!',
        importSuccess: 'ÄÃ£ nháº­p cÃ i Ä‘áº·t thÃ nh cÃ´ng! Äang táº£i láº¡i...',
        importError: 'Lá»—i: File cÃ i Ä‘áº·t khÃ´ng há»£p lá»‡!',
        exporting: 'Äang xuáº¥t...',
        importing: 'Äang nháº­p...',
        confirmImport: 'Báº¡n cÃ³ cháº¯c muá»‘n nháº­p cÃ i Ä‘áº·t má»›i? Äiá»u nÃ y sáº½ ghi Ä‘Ã¨ lÃªn cÃ i Ä‘áº·t hiá»‡n táº¡i.',
        backupCreated: 'ÄÃ£ táº¡o báº£n sao lÆ°u tá»± Ä‘á»™ng',
        invalidFileType: 'Chá»‰ cháº¥p nháº­n file JSON!',
        fileTooLarge: 'File quÃ¡ lá»›n (tá»‘i Ä‘a 5MB)!',
        noSettingsToExport: 'KhÃ´ng cÃ³ cÃ i Ä‘áº·t nÃ o Ä‘á»ƒ xuáº¥t!',
        extensionEnabled: 'Báº­t/Táº¯t Extension',
        extensionDisabledTitle: 'Extension Ä‘Ã£ táº¯t',
        extensionDisabledDesc: 'TubeTuner hiá»‡n Ä‘ang Ä‘Æ°á»£c táº¯t. Báº­t láº¡i Ä‘á»ƒ sá»­ dá»¥ng cÃ¡c tÃ­nh nÄƒng tÃ¹y chá»‰nh YouTube.',
        // About section translations
        aboutTitle: 'Giá»›i thiá»‡u',
        aboutDescription: 'TubeTuner lÃ  extension giÃºp báº¡n tÃ¹y chá»‰nh tráº£i nghiá»‡m YouTube theo Ã½ muá»‘n. áº¨n cÃ¡c pháº§n tá»­ khÃ´ng cáº§n thiáº¿t nhÆ° thanh tiáº¿n trÃ¬nh, Shorts, quáº£ng cÃ¡o, vÃ  nhiá»u thÃ nh pháº§n khÃ¡c Ä‘á»ƒ táº­p trung vÃ o ná»™i dung quan trá»ng.',
        aboutFeaturesTitle: 'TÃ­nh nÄƒng chÃ­nh:',
        aboutFeature1: 'âœ¨ áº¨n/hiá»‡n cÃ¡c pháº§n tá»­ giao diá»‡n YouTube',
        aboutFeature2: 'ðŸŽ¨ Cháº¿ Ä‘á»™ giao diá»‡n Ä‘en tráº¯ng',
        aboutFeature3: 'ðŸ”„ Äá»“ng bá»™ cÃ i Ä‘áº·t giá»¯a cÃ¡c tab',
        aboutFeature4: 'ðŸ’¾ Sao lÆ°u/khÃ´i phá»¥c cÃ i Ä‘áº·t',
        aboutFeature5: 'ðŸŒ Há»— trá»£ Ä‘a ngÃ´n ngá»¯ (VI/EN)',
        aboutGithubLink: 'GitHub Repository',
        advancedSettings: 'CÃ i Ä‘áº·t nÃ¢ng cao',
        // Status
        hidingFeatures: 'Äang áº©n',
        progressBar: 'thanh tiáº¿n trÃ¬nh',
        duration: 'thá»i lÆ°á»£ng',
        shorts: 'shorts',
        videoSidebar: 'thanh bÃªn video',
        notificationsBell: 'chuÃ´ng thÃ´ng bÃ¡o',
        topHeader: 'thanh Ä‘iá»u hÆ°á»›ng trÃªn',
        exploreSection: 'pháº§n khÃ¡m phÃ¡',
        allDisabled: 'ÄÃ£ táº¯t táº¥t cáº£'
    },
    en: {
        title: 'TubeTuner',
        subtitle: 'Hide unwanted YouTube elements',
        // Content & Feed Controls
        contentFeedControlsTitle: 'Content & Feed Controls',
        hideHomeFeed: 'Hide Home Feed',
        hideVideoSidebar: 'Hide Video Sidebar',
        hideShorts: 'Hide Shorts',
        hideComments: 'Hide Comments Section',
        hideChannel: 'Hide Channel',
        // Interface Elements
        interfaceElementsTitle: 'Interface Elements',
        hideTopHeader: 'Hide Top Header/Navigation Bar',
        hideNotificationsBell: 'Hide Notifications Bell',
        hideExploreSection: 'Hide Explore Section',
        hideMoreFromYouTube: 'Hide "More from YouTube" Section',
        hideButtonsBar: 'Hide Buttons Bar',
        // Video Controls
        videoControlsTitle: 'Video Controls',
        hideProgressBar: 'Hide progress bar',
        hideDuration: 'Hide video duration',
        hideEndScreenCards: 'Hide End Screen Cards/Annotations',
        hideDescription: 'Hide Video Description',
        // General
        active: 'Active',
        inactive: 'Inactive',
        infoTitle: 'Introduction',
        infoContent: 'This extension helps you focus on video content without distractions from:',
        featureProgress: 'Unnecessary interface elements',
        featureDuration: 'Recommended content and ads',
        featureShorts: 'Distracting features',
        homeFeed: 'Home Feed',
        infoExtra: 'Customize your YouTube experience with 14 hide/show options.',
        noticeTitle: 'Important Notice',
        noticeDesc: 'For the best experience, please enable the extension before visiting YouTube.',
        // Grayscale feature translations
        grayscale: 'Grayscale interface',
        enableGrayscale: 'Enable grayscale interface',
        disableGrayscale: 'Disable grayscale interface',
        // Shop feature translations
        shop: 'YouTube Shop',
        hideShop: 'Hide YouTube Shop',
        // Presets UI
        presetsLabel: 'Presets',
        applyPreset: 'Apply preset',
        confirmApplyPreset: 'Apply selected preset? This will overwrite current settings.',
        presetApplied: 'Applied successfully',
        applyingPreset: 'Applying preset...',
        confirm: 'Confirm',
        cancel: 'Cancel',
        presetNone: 'None',
        presetBalanced: 'Balanced',
        presetFocus: 'Focus',
        builtInGroup: 'Built-in',
        customGroup: 'Custom',
        presetNamePlaceholder: 'Preset name',
        savePreset: 'Save preset',
        deletePreset: 'Delete preset',
        importPresets: 'Import presets',
        exportPresets: 'Export presets',
        presetSaved: 'Preset saved',
        presetDeleted: 'Preset deleted',
        presetsImported: 'Presets imported',
        presetNameRequired: 'Please enter a name for the preset',
        selectPresetToDelete: 'Please select a custom preset to delete',
        confirmOverwritePreset: 'Preset "%s" already exists. Overwrite?',
        presetNameReserved: 'This name is reserved by the system',
        confirmDeletePreset: 'Are you sure you want to delete preset',
        // Settings management
        settingsManagement: 'Settings Management',
        exportSettings: 'Export Settings',
        importSettings: 'Import Settings',
        exportSuccess: 'Settings exported successfully!',
        importSuccess: 'Settings imported successfully! Reloading...',
        importError: 'Error: Invalid settings file!',
        exporting: 'Exporting...',
        importing: 'Importing...',
        confirmImport: 'Are you sure you want to import new settings? This will overwrite current settings.',
        backupCreated: 'Auto backup created',
        invalidFileType: 'Only JSON files are accepted!',
        fileTooLarge: 'File too large (max 5MB)!',
        noSettingsToExport: 'No settings to export!',
        extensionEnabled: 'Enable/Disable Extension',
        extensionDisabledTitle: 'Extension Disabled',
        extensionDisabledDesc: 'TubeTuner is currently disabled. Enable it to use YouTube customization features.',
        // About section translations
        aboutTitle: 'About',
        aboutDescription: 'TubeTuner is an extension that helps you customize your YouTube experience as you wish. Hide unnecessary elements like progress bars, Shorts, ads, and many other components to focus on important content.',
        aboutFeaturesTitle: 'Key Features:',
        aboutFeature1: 'âœ¨ Show/hide YouTube interface elements',
        aboutFeature2: 'ðŸŽ¨ Grayscale interface mode',
        aboutFeature3: 'ðŸ”„ Sync settings across tabs',
        aboutFeature4: 'ðŸ’¾ Backup/restore settings',
        aboutFeature5: 'ðŸŒ Multi-language support (VI/EN)',
        aboutGithubLink: 'GitHub Repository',
        advancedSettings: 'Advanced Settings',
        // Status
        hidingFeatures: 'Hiding',
        progressBar: 'progress bar',
        duration: 'duration',
        shorts: 'shorts',
        videoSidebar: 'video sidebar',
        notificationsBell: 'notifications bell',
        topHeader: 'top header',
        exploreSection: 'explore section',
        allDisabled: 'All features disabled'
    }
};

export const I18nModule = {
    currentLang: 'en',

    t(key) {
        return TRANSLATIONS[this.currentLang][key] || `[${key}]`;
    },

    changeLanguage(lang) {
        try {
            this.setLanguage(lang, true);
        } catch (e) {
            console.error('Error changing language:', e);
        }
    },

    setLanguage(lang, save = true) {
        this.currentLang = lang;

        // Remove active class from all language buttons
        document.querySelectorAll('.ext-lang-button').forEach(btn => {
            btn.classList.remove('active');
        });

        // Add active class to selected language button
        const langBtn = document.getElementById(`lang-${lang}`);
        if (langBtn) langBtn.classList.add('active');

        // Update all UI elements based on language
        this.updateLanguageUI();

        if (save) {
            chrome.storage.sync.set({ language: lang });
        }
    },

    updateLanguageUI() {
        // Update title
        const titleEl = document.querySelector('.ext-title');
        const subtitleEl = document.querySelector('.ext-subtitle');
        if (titleEl) titleEl.textContent = this.t('title');
        if (subtitleEl) subtitleEl.textContent = this.t('subtitle');

        // Update section titles
        const sectionTitles = document.querySelectorAll('.ext-section-title');
        const titleMap = [
            this.t('aboutTitle'),
            this.t('contentFeedControlsTitle'),
            this.t('interfaceElementsTitle'),
            this.t('videoControlsTitle')
        ];
        sectionTitles.forEach((el, idx) => {
            if (titleMap[idx]) el.textContent = titleMap[idx];
        });

        // Update About section
        const aboutDescription = document.getElementById('aboutDescription');
        const aboutFeaturesTitle = document.getElementById('aboutFeaturesTitle');
        const aboutFeatures = ['aboutFeature1', 'aboutFeature2', 'aboutFeature3', 'aboutFeature4', 'aboutFeature5'];
        const aboutGithubLinkText = document.getElementById('aboutGithubLinkText');
        
        if (aboutDescription) aboutDescription.textContent = this.t('aboutDescription');
        if (aboutFeaturesTitle) aboutFeaturesTitle.textContent = this.t('aboutFeaturesTitle');
        
        aboutFeatures.forEach((featureId) => {
            const featureEl = document.getElementById(featureId);
            if (featureEl) {
                const translationKey = featureId;
                featureEl.textContent = this.t(translationKey);
            }
        });
        
        if (aboutGithubLinkText) aboutGithubLinkText.textContent = this.t('aboutGithubLink');

        // Update extension disabled notice
        const extensionDisabledTitle = document.getElementById('extensionDisabledTitle');
        const extensionDisabledDesc = document.getElementById('extensionDisabledDesc');
        if (extensionDisabledTitle) extensionDisabledTitle.textContent = this.t('extensionDisabledTitle');
        if (extensionDisabledDesc) extensionDisabledDesc.textContent = this.t('extensionDisabledDesc');

        // Update Advanced Settings button
        const openSettingsText = document.getElementById('openSettingsText');
        if (openSettingsText) openSettingsText.textContent = this.t('advancedSettings');

        // Update control labels
        const labelMappings = [
            { id: 'homeFeedSwitch', text: this.t('hideHomeFeed') },
            { id: 'videoSidebarSwitch', text: this.t('hideVideoSidebar') },
            { id: 'shortsSwitch', text: this.t('hideShorts') },
            { id: 'commentsSwitch', text: this.t('hideComments') },
            { id: 'hideChannelSwitch', text: this.t('hideChannel') },
            { id: 'topHeaderSwitch', text: this.t('hideTopHeader') },
            { id: 'notificationsBellSwitch', text: this.t('hideNotificationsBell') },
            { id: 'exploreSectionSwitch', text: this.t('hideExploreSection') },
            { id: 'moreFromYouTubeSwitch', text: this.t('hideMoreFromYouTube') },
            { id: 'buttonsBarSwitch', text: this.t('hideButtonsBar') },
            { id: 'progressSwitch', text: this.t('hideProgressBar') },
            { id: 'durationSwitch', text: this.t('hideDuration') },
            { id: 'endScreenCardsSwitch', text: this.t('hideEndScreenCards') },
            { id: 'hideDescriptionSwitch', text: this.t('hideDescription') },
            { id: 'grayscaleSwitch', text: this.t('grayscale') },
            { id: 'shopSwitch', text: this.t('hideShop') },
            { id: 'extensionEnabledSwitch', text: this.t('extensionEnabled') }
        ];

        labelMappings.forEach(({ id, text }) => {
            const switchEl = document.getElementById(id);
            if (switchEl) {
                const label = switchEl.closest('.ext-control-item')?.querySelector('.ext-control-label');
                if (label) label.textContent = text;
            }
        });

        // Update settings section
        const settingsTitle = document.querySelector('.ext-settings-title');
        const exportBtn = document.querySelector('#exportSettingsBtn span');
        const importBtn = document.querySelector('#importSettingsBtn span');
        if (settingsTitle) settingsTitle.textContent = this.t('settingsManagement');
        if (exportBtn) exportBtn.textContent = this.t('exportSettings');
        if (importBtn) importBtn.textContent = this.t('importSettings');

        // Update presets
        const presetsLabel = document.querySelector('.ext-presets-label');
        const applyPresetBtn = document.getElementById('applyPresetBtn');
        if (presetsLabel) presetsLabel.textContent = this.t('presetsLabel');
        if (applyPresetBtn) applyPresetBtn.textContent = this.t('applyPreset');

        const savePresetBtn = document.getElementById('savePresetBtn');
        const deletePresetBtn = document.getElementById('deletePresetBtn');
        const importPresetsBtn = document.getElementById('importPresetsBtn');
        const exportPresetsBtn = document.getElementById('exportPresetsBtn');
        if (savePresetBtn) savePresetBtn.textContent = this.t('savePreset');
        if (deletePresetBtn) deletePresetBtn.textContent = this.t('deletePreset');
        if (importPresetsBtn) importPresetsBtn.textContent = this.t('importPresets');
        if (exportPresetsBtn) exportPresetsBtn.textContent = this.t('exportPresets');

        const presetNameInput = document.getElementById('presetNameInput');
        if (presetNameInput) presetNameInput.placeholder = this.t('presetNamePlaceholder');

        // Update preset options
        const presetSelect = document.getElementById('presetSelect');
        if (presetSelect) {
            const noneOpt = presetSelect.querySelector('option[value="builtin:none"]') || presetSelect.querySelector('option[value="none"]');
            const balancedOpt = presetSelect.querySelector('option[value="builtin:balanced"]') || presetSelect.querySelector('option[value="balanced"]');
            const focusOpt = presetSelect.querySelector('option[value="builtin:focus"]') || presetSelect.querySelector('option[value="focus"]');
            if (noneOpt) noneOpt.textContent = this.t('presetNone');
            if (balancedOpt) balancedOpt.textContent = this.t('presetBalanced');
            if (focusOpt) focusOpt.textContent = this.t('presetFocus');

            const optgroups = presetSelect.querySelectorAll('optgroup');
            if (optgroups[0]) optgroups[0].label = this.t('builtInGroup');
            if (optgroups[1]) optgroups[1].label = this.t('customGroup');
        }
    },

    initializeLanguage() {
        chrome.storage.sync.get('language', (data) => {
            const savedLanguage = data.language || 'en';
            this.setLanguage(savedLanguage, false);
        });
    }
};
